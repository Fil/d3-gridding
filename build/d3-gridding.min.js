// https://github.com/romsson/d3-gridding Version 0.0.9. Copyright 2017 Romain Vuillemot.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-scale"),require("d3-array"),require("d3-hierarchy"),require("d3-shape")):"function"==typeof define&&define.amd?define("d3-gridding",["exports","d3-scale","d3-array","d3-hierarchy","d3-shape"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,i,n,_){"use strict";function r(e,t){return t.cols=Math.ceil(Math.sqrt(e.length)),t.rows=Math.ceil(e.length/t.cols),t.x.domain([0,t.cols+.5]).range([0,t.size[0]]),t.y.domain([0,t.rows]).range([0,t.size[1]]),e.forEach(function(e,i){var n=i%t.cols,_=Math.floor(i/t.cols);e[t.__x]=t.x(n)+t.padding+t.offset[0],e[t.__y]=t.y(_)+t.padding+t.offset[1],e[t.__width]=t.size[0]/(t.cols+.5)-2*t.padding,e[t.__height]=t.size[1]/t.rows-2*t.padding,"left"===t.orient?_%2==1&&(e[t.__x]+=e[t.__width]/2):_%2==0&&(e[t.__x]+=e[t.__width]/2),e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function o(e,t){return t.cols=t.rows=1,e.forEach(function(e){e[t.__x]=0+t.padding+t.offset[0],e[t.__y]=0+t.padding+t.offset[1],e[t.__width]=t.size[0]-2*t.padding,e[t.__height]=t.size[1]-2*t.padding,e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2,e[t.__tx]=e[t.__cx]/2,e[t.__ty]=t.padding/2,e[t.__lx]=e[t.__cx]+t.padding/2,e[t.__ly]=0,e[t.__rx]=e[t.__cx]-t.padding/2,e[t.__ry]=e[t.__yx]/2}),e}function a(e,t){var i=t.size[0]/(2*e.length),n=t.size[1]/(2*e.length);return e.forEach(function(_,r){_[t.__x]=0+t.offset[0]+i*r,_[t.__y]=0+t.offset[1]+n*r,_[t.__width]=t.size[0]-i*e.length,_[t.__height]=t.size[1]-n*e.length,_[t.__cx]=_[t.__x]+_[t.__width]/2,_[t.__cy]=_[t.__y]+_[t.__height]/2}),e}function d(e,t){return t.valueX?t.x.domain(i.extent(e,t.valueX)).range([t.padding,t.size[0]-2*t.padding]):(t.valueX=function(){return Math.random()},t.x.domain([0,1]).range([t.padding,t.size[0]-2*t.padding])),t.valueY?t.y.domain(i.extent(e,t.valueY)).range([t.padding,t.size[1]-2*t.padding]):(t.valueY=function(){return Math.random()},t.y.domain([0,1]).range([t.padding,t.size[1]-2*t.padding])),e.forEach(function(i){i[t.__x]=t.x(t.valueX(i))+t.offset[0],i[t.__y]=t.y(t.valueY(i))+t.offset[1],i[t.__width]=t.cellSize?t.cellSize[0]:t.size[0]/e.length,i[t.__height]=t.cellSize?t.cellSize[1]:t.size[1]/e.length,i[t.__cx]=i[t.__x]+i[t.__width]/2,i[t.__cy]=i[t.__y]+i[t.__height]/2}),e}function u(e,t){var i=t.size[0]/(2*e.length),n=t.size[1]/(2*e.length);return e.forEach(function(e,_){e[t.__width]=t.size[0]-i*_*2,e[t.__height]=t.size[1]-n*_*2,"top right"===t.orient?(e[t.__x]=t.size[0]-e.width+t.offset[0],e[t.__y]=0+t.offset[1]):"bottom right"===t.orient?(e[t.__x]=t.size[0]-e[t.__width]+t.offset[0],e[t.__y]=t.size[1]-e[t.__height]+t.offset[1]):"bottom left"===t.orient?(e[t.__x]=0+t.offset[0],e[t.__y]=t.size[1]-e[t.__height]+t.offset[1]):(e[t.__x]=0+t.offset[0],e[t.__y]=0+t.offset[1]),e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function l(e,t){return t.x.domain([0,e.length]).range([0,t.size[0]]),t.y.domain([0,e.length]).range([0,t.size[1]]),e.forEach(function(i,n){"up"==t.orient?(i[t.__x]=t.x(n)+t.offset[0],i[t.__y]=t.size[1]-(t.y(n)+t.offset[1])-t.size[1]/e.length):(i[t.__x]=t.x(n)+t.offset[0],i[t.__y]=t.y(n)+t.offset[1]),i[t.__width]=t.size[0]/e.length,i[t.__height]=t.size[1]/e.length,i[t.__cx]=i[t.__x]+i[t.__width]/2,i[t.__cy]=i[t.__y]+i[t.__height]/2}),e}function h(e,t){return t.cols=Math.ceil(Math.sqrt(e.length)),t.rows=Math.ceil(e.length/t.cols),void 0!==t.cellSize&&null!==t.cellSize&&(t.size[0]=t.cellSize[0]*t.cols,t.size[1]=t.cellSize[1]*t.rows),t.x.domain([0,t.cols]).range([0,t.size[0]]),t.y.domain([0,t.rows]).range([0,t.size[1]]),e.forEach(function(e,i){var n=i%t.cols,_=Math.floor(i/t.cols);e[t.__x]=t.x(n)+t.padding+t.offset[0],e[t.__y]=t.y(_)+t.padding+t.offset[1],e[t.__width]=t.size[0]/t.cols-2*t.padding,e[t.__height]=t.size[1]/t.rows-2*t.padding,"up"==t.orient&&(e[t.__y]=t.size[1]-e[t.__y]-e[t.__height]),e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2,e.tx=e[t.__x]+e[t.__width]/2,e.ty=t.padding/2}),e}function s(e,t){t.rows=e.length,void 0!==t.cellSize&&null!==t.cellSize&&(t.size[0]=2*t.cellSize[0],t.size[1]=t.cellSize[1]*t.rows),t.y.domain([0,t.rows]).range([0,t.size[1]-2*t.padding]);var n;t.valueY?(n=t.valueY,t.y.domain([0,i.sum(e,n)]).range([0,t.size[1]-2*t.padding])):(n=function(){return 1},t.y.domain([0,e.length]).range([0,t.size[1]-2*t.padding]));var _;return t.valueWidth?(_=t.valueWidth,t.width.domain(i.extent(e,_)).range([0,t.size[0]-2*t.padding])):(_=function(){return 1},t.width.domain([0,1]).range([0,t.size[0]-2*t.padding])),e[0].y0=0,e.forEach(function(i,r){i[t.__x]=0+t.padding+t.offset[0],i[t.__y]=i.y0+t.padding+t.offset[1],i[t.__width]=t.width(_(i)),i[t.__height]=t.y(n(i)),r<e.length-1&&(e[r+1].y0=i.y0+i[t.__height]),i[t.__cx]=i[t.__x]+i[t.__width]/2,i[t.__cy]=i[t.__y]+i[t.__height]/2}),e}function c(e,t){return e.forEach(function(e){e[t.__x]=e[t.__x]||0,e[t.__y]=e[t.__y]||0,e[t.__width]=e[t.__width]||t.size[0],e[t.__height]=e[t.__height]||t.size[1],e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function f(e,t){var i=n.pack().size([t.size[0],t.size[1]]).padding(t.padding),_=i(n.stratify().id(function(e,t){return t}).parentId(function(e,t){return 0===t?"":0})([{}].concat(e)).sum(function(){return 1}));return e.forEach(function(e,i){e[t.__x]=_.children[i].x+t.offset[0],e[t.__y]=_.children[i].y+t.offset[1],e[t.__width]=_.children[i].r,e[t.__height]=_.children[i].r,e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function g(e,t){var i=t.size[0]/(2*e.length),n=t.size[1]/(2*e.length);return e.forEach(function(e,_){e[t.__x]=0+t.offset[0]+i*_,e[t.__y]=0+t.offset[1]+n*_,e[t.__width]=t.size[0]-i*_*2,e[t.__height]=t.size[1]-n*_*2,e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function y(e,t){t.radius||(t.radius=Math.min(t.size[0],t.size[1])-t.size[1]/e.length*2);var i=_.arc().outerRadius(t.radius).innerRadius(0),n=_.pie().sort(t.sort).value(function(){return 1}),r=n(e);return e.forEach(function(n,_){n[t.__width]=t.size[0]/e.length,n[t.__height]=t.size[1]/e.length,n[t.__x]=i.centroid(r[_])[0]+t.size[0]/2+t.offset[0]-n[t.__width]/2,n[t.__y]=i.centroid(r[_])[1]+t.size[1]/2+t.offset[1]-n[t.__height]/2,n[t.__cx]=n[t.__x]+n[t.__width]/2,n[t.__cy]=n[t.__y]+n[t.__height]/2}),e}function p(e,t){var n=_.stack().keys(e.map(function(e,t){return t+"_"})).value(function(t,i){return e.indexOf(t[i])});t.y.domain([0,i.sum(i.range(e.length))+e.length]).range([0,t.size[1]]);var r={};e.map(function(e,t){r[t+"_"]=e});var o=n([r]);return e.forEach(function(e,i){var n=o[i][0];e[t.__x]=t.offset[0],e[t.__y]=t.y(n[1])+t.offset[1],e[t.__width]=t.size[0],e[t.__height]=t.y(n[1])-t.y(n[0]),e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function x(e,t){var i=t.size[0]/(2*e.length);return e.forEach(function(e,n){e[t.__x]=0+t.offset[0]+i*n,e[t.__y]=0+t.offset[1],e[t.__width]=t.size[0]-i*n*2,e[t.__height]=t.size[1],e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function z(e,t){var i=n.stratify().id(t.id).parentId(t.parentId)(e),_=n.tree().size([t.size[0],t.size[1]/2]),r=n.hierarchy(i,function(e){return e.children});return r=_(r),e.forEach(function(i,n){i[t.__width]=t.cellSize?t.cellSize[0]:t.size[0]/e.length,i[t.__height]=t.cellSize?t.cellSize[1]:t.size[1]/e.length,i[t.__x]=r.descendants()[n].x+t.offset[0]-i[t.__width]/2,i[t.__y]=r.descendants()[n].y+t.offset[1],i[t.__cx]=i[t.__x]+i[t.__width]/2,i[t.__cy]=i[t.__y]+i[t.__height]/2}),e}function v(e,t){var i=n.treemap().size([t.size[0],t.size[1]]).padding(t.padding),_=n.stratify().id(t.id).parentId(t.parentId),r=_([{}].concat(e)).sum(function(){return 1}),o=i(r);return e.forEach(function(e,i){e[t.__x]=o.descendants()[i].x0+t.offset[0],e[t.__y]=o.descendants()[i].y0+t.offset[1],e[t.__width]=o.descendants()[i].x1-o.descendants()[i].x0,e[t.__height]=o.descendants()[i].y1-o.descendants()[i].y0,e[t.__cx]=e[t.__x]+e[t.__width]/2,e[t.__cy]=e[t.__y]+e[t.__height]/2}),e}function w(e,t){t.cols=e.length,t.x.domain([0,t.cols]).range([t.padding,t.size[0]-t.padding]);var n;t.valueHeight?(n=t.valueHeight,t.height.domain([0,i.max(e,n)]).range([0,t.size[1]-2*t.padding])):(n=function(){return 1},t.height.domain([0,1]).range([0,t.size[1]-2*t.padding]));var _;return t.valueWidth?(_=t.valueWidth,t.width.domain([0,i.sum(e,_)]).range([0,t.size[0]-2*t.padding])):(_=function(){return 1},t.width.domain([0,e.length]).range([0,t.size[0]-2*t.padding])),e[0].x0=0,e.forEach(function(i,r){i[t.__x]=i.x0+t.offset[0]+t.padding,"down"==t.orient?i[t.__y]=0+t.offset[1]+t.padding:"up"===t.orient?i[t.__y]=t.size[1]-(t.height(n(i))+t.offset[0])+t.padding:i[t.__y]=0+t.offset[1]+t.padding,i[t.__width]=t.width(_(i)),i[t.__height]=t.height(n(i)),r<e.length-1&&(e[r+1].x0=i.x0+i[t.__width]),i[t.__cx]=i[t.__x]+i[t.__width]/2,i[t.__cy]=i[t.__y]+i[t.__height]/2}),e}function m(){function e(e){return i.__x=i.__prefix+"x",i.__y=i.__prefix+"y",i.__width=i.__prefix+"width",i.__height=i.__prefix+"height",i.__cx=i.__prefix+"cx",i.__cy=i.__prefix+"cy",void 0!==e&&""!==e&&null!==e||(e=[]),e=void 0===i.value(e)||""===i.value(e)||null===i.value(e)?[]:"object"!=typeof i.value(e)[0]?Array.prototype.map.call(e,function(e,t){return{__value:e,__index:t}}):i.value(e),i.layout(e,i)}var i={__prefix:"",__x:"",__y:"",__width:"",__height:"",__cx:"",__cy:"",cellSize:null,cols:null,height:t.scaleLinear(),id:function(e,t){return t},layout:c,mode:"identity",modes:{brick:{layout:r,properties:[{key:"orient",value:"top"}]},cascade:{layout:a,properties:[]},central:{layout:o,properties:[]},coordinate:{layout:d,properties:[{key:"valueX",value:null},{key:"valueY",value:null}]},corner:{layout:u,properties:[{key:"orient",value:"top right"}]},diagonal:{layout:l,properties:[{key:"orient",value:"top"}]},grid:{layout:h,properties:[{key:"orient",value:"top"}]},horizontal:{layout:s,properties:[{key:"valueY",value:null},{key:"valueWidth",value:null}]},pack:{layout:f,properties:[{key:"orient",value:"top"}]},pyramid:{layout:g,properties:[{key:"orient",value:"top"}]},radial:{layout:y,properties:[{key:"orient",value:"top"}]},stack:{layout:p,properties:[{key:"orient",value:"top"}]},step:{layout:x,properties:[{key:"orient",value:"top"}]},tree:{layout:z,properties:[{key:"orient",value:"top"}]},treemap:{layout:v,properties:[{key:"orient",value:"top"}]},vertical:{layout:w,properties:[{key:"orient",value:"top"},{key:"orient",value:"left"},{key:"orient",value:"right"},{key:"valueHeight",value:null},{key:"valueY",value:null}]}},offset:[0,0],orient:"down",parentId:function(e,t){return 0===t?null:0},padding:0,radius:null,rows:null,size:[1,1],sort:function(e,t){return e-t},value:function(e){return e},valueHeight:null,valueWidth:null,valueX:null,valueY:null,width:t.scaleLinear(),x:t.scaleLinear(),y:t.scaleLinear()};return e.mode=function(t){return arguments.length?(i.mode=t,"identity"===i.mode?i.layout=c:Object.keys(i.modes).indexOf(t)>=0&&(i.layout=i.modes[i.mode].layout),e):i.mode},e.modes=function(e){return 1===arguments.length?i.modes[e].properties:Object.keys(i.modes)},e.size=function(t){return arguments.length?(i.size=t,e):i.size},e.cellSize=function(t){return arguments.length?(i.cellSize=t,e):i.cellSize},e.value=function(t){return arguments.length?(i.value=t,e):i.value},e.valueX=function(t){return arguments.length?(i.valueX="string"==typeof t?function(e){return e[t]}:t,e):i.valueX},e.valueY=function(t){return arguments.length?(i.valueY="string"==typeof t?function(e){return e[t]}:t,e):i.valueY},e.valueHeight=function(t){return arguments.length?(i.valueHeight="string"==typeof t?function(e){return e[t]}:t,e):i.valueHeight},e.valueWidth=function(t){return arguments.length?(i.valueWidth="string"==typeof t?function(e){return e[t]}:t,e):i.valueWidth},e.sort=function(t){return arguments.length?(i.sort=t,e):i.sort},e.padding=function(t){return arguments.length?(i.padding=t,e):i.padding},e.offset=function(t){return arguments.length?(i.offset=t,e):i.offset},e.orient=function(t){return arguments.length?(i.orient=t,e):i.orient},e.cols=function(t){return arguments.length?(i.cols=t,e):i.cols},e.rows=function(t){return arguments.length?(i.rows=t,e):i.rows},e.radius=function(t){return arguments.length?(i.radius=t,e):i.radius},e.prefix=function(t){return arguments.length?(i.__prefix=t,e):i.__prefix},e.id=function(t){return arguments.length?(i.id=t,e):i.id},e.parentId=function(t){return arguments.length?(i.parentId=t,e):i.parentId},e}e.gridding=m,Object.defineProperty(e,"__esModule",{value:!0})});